# Chapter 14 ì¼ê´€ì„± ìˆëŠ” í˜‘ë ¥

ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ë‹¤ë³´ë©´ ìœ ì‚¬í•œ ìš”êµ¬ì‚¬í•­ì„ ë°˜ë³µì ìœ¼ë¡œ ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ê²Œ ë˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤.

ì´ëŸ° ê°ì²´ì˜ í˜‘ë ¥êµ¬ì¡°ê°€ ì„œë¡œ ë‹¤ë¥¸ ê²½ìš°ì—ëŠ” ì½”ë“œë¥¼ ì´í•´í•˜ê¸° ì–´ë µê³  ì½”ë“œ ìˆ˜ì •ìœ¼ë¡œ ì¸í•´ ë²„ê·¸ê°€ ë°œìƒí•  ìœ„í—˜ë„ ë†’ì•„ì§„ë‹¤. ê·¸ë¦¬ê³  ìœ ì‚¬í•œ ìš”êµ¬ì‚¬í•­ì„ ê³„ì† ì¶”ê°€í•˜ë‹¤ ë³´ë©´ ì¼ê´€ì„±ì€ ë–¨ì–´ì§€ê²Œ ë˜ì–´ìˆë‹¤.

ì´ëŸ´ë•Œ ì¼ê´€ì„±ì„ ë†’ì´ë ¤ë©´ í˜‘ë ¥íŒ¨í„´ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.

ìœ ì‚¬í•œ íŒ¨í„´ì„ ë”°ë¥¸ë‹¤ë©´ ì‹œìŠ¤í…œì„ ì´í•´í•˜ê³  í™•ì¥í•˜ê¸° ìœ„í•´ ìš”êµ¬ë˜ëŠ” ì •ì‹ ì ì¸ ë¶€ë‹´ì„ í¬ê²Œ ì¤„ì¼ìˆ˜ ìˆë‹¤.

í˜‘ë ¥íŒ¨í„´ì€ ì ìš©í•œ ì½”ë“œëŠ” ì•„ë˜ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## 1. í•¸ë“œí° ê³¼ê¸ˆ ì‹œìŠ¤í…œ ë³€ê²½í•˜ê¸°

| ìœ í˜• | í˜•ì‹ | ì˜ˆ |
| --- | --- | --- |
| ê³ ì •ìš”ê¸ˆ ë°©ì‹ | Aì´ˆë‹¹ Bì› | 10ì´ˆë‹¹ 18ì› |
| ì‹œê°„ëŒ€ë³„ ë°©ì‹ | Aì‹œë¶€í„° Bì‹œê¹Œì§€ Cì´ˆë‹¹ Dì›
Bì‹œë¶€í„° Cì‹œê¹Œì§€ Cì´ˆë‹¹ Eì› | 00ì‹œë¶€í„° 19ì‹œê¹Œì§€ 10ì´ˆë‹¹ 18ì›
19ì‹œë¶€í„° 24ì‹œê¹Œì§€ 10ì´ˆë‹¹ 15ì› |
| ìš”ì¼ë³„ ë°©ì‹ | í‰ì¼ì—ëŠ” Aì´ˆë‹¹ Bì›
ê³µíœ´ì¼ì—ëŠ” Aì´ˆë‹¹ Cì› | í‰ì¼ì—ëŠ” 10ì´ˆë‹¹ 38ì›
ê³µíœ´ì¼ì—ëŠ” 10ì´ˆë‹¹ 19ì› |
| êµ¬ê°„ë³„ ë°©ì‹ | ì´ˆê¸° Aë¶„ ë™ì•ˆ Bì´ˆë‹¹ Cì›
Aë¶„ ~ Dë¶„ê¹Œì§€ Bì´ˆë‹¹ Dì›
Dë¶„ ì´ˆê³¼ì‹œ Bì´ˆë‹¹ Eì› | ì´ˆê¸° 1ë¶„ ë™ì•ˆ 10ì´ˆë‹¹ 50ì›
ì´ˆê¸° 1ë¶„ ì´í›„ 10ì´ˆë‹¹ 20ì› |

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled.png)

ìƒˆë¡œìš´ ê¸°ë³¸ì •ì±…ì„ ì ìš©í•´ ê°€ëŠ¥í•œ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ ë‚˜íƒ€ë‚¸ ê²ƒì´ë‹¤.

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%201.png)

êµ¬í˜„í•´ë³¼ í´ë˜ìŠ¤ êµ¬ì¡°ë„ì´ë‹¤.

1) ê³ ì • ìš”ê¸ˆ ë°©ì‹ êµ¬í˜„

```java
public class FixedFeePolicy extends BasicRatePolicy{
	private Money amount;
	private Duration seconds;

	public FixedFeePolicy(Money amount, Duration seconds){
		this.amount = amount;
		this.seconds = seconds;
	}

	@Override
	protected Money calculateCallFee(Call call){
		return amount.times(call.getDuration().getSeconds() / seconds.getSeconds());
	}
}
```

2) ì‹œê°„ëŒ€ë³„ ë°©ì‹ êµ¬í˜„í•˜ê¸°

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%202.png)

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%203.png)

11 ì¥ì— êµ¬í˜„í•œ ì‹œê°„ëŒ€ë³„ ë°©ì‹ì„ ì ìš©í•˜ë©´ ë²„ê·¸ê°€ ìƒê¸°ê²Œ ëœë‹¤. 

```java
public class DateTimeInterval{
	private LocalDateTime from;
	private LocalDateTime to;

	public static DateTimeInterval of(LocalDateTime from, LocalDateTime to){
		return new DateTimeInterval(from, to);
	}

	public static DateTimeInterval toMidnight(LocalDateTime from){
		return new DateTimeInterval(
			from,
			LocalDateTime.of(from.toLocalDate(), LocalTime.of(23, 59, 59, 999_999_999)));
	}

	public static DateTimeInterval fromMidnight(LocalDateTime to){
		return new DateTimeInterval(
			LocalDateTime.of(to.toLocalDate(), LocalTime.of(0, 0)),
			to);
		)
	}

	public static DateTimeInterval during(LocalDate date){
		return new DateTimeInterval(
			LocalDateTime.of(date, LocalTime.of(0, 0)),
			LocalDateTime.of(date, LocalTIme.of(23, 59, 59, 999_999_999)));
		)
	}

	private DateTimeInterval(LocalDateTime from, LocalDateTime to){
		this.from = from;
		this.to = to;
	}

	public Duration duration(){
		return Duration.between(from, to);
	}

	public LocalDateTime getFrom(){
		return from;
	}

	public LocalDateTime getTo(){
		return to;
	}
}
```

```java
public class Call{
	// private LocalDateTime from;
	// private LocalDateTime to;
  // ->
	private DateTimeInterval interval;

	public Call(LocalDateTime from, LocalDateTime to){
		this.interval = DateTimeInterval.of(from, to);
	}

	public Duration getDuration(){
		return interval.duration();
	}

	public LocalDateTime getFrom(){
		return interval.getFrom();
	}

	public LocalDateTime getTo(){
		return interval.getTo();
	}

	public DateTimeInterval getInterval(){
		return interval;
	}
}
```

ë‘ ë‹¨ê³„ë¡œ ë‚˜ëˆ  êµ¬í˜„í•  í•„ìš”ê°€ ìˆë‹¤.

- í†µí™” ê¸°ê°„ì„ ì¼ìë³„ë¡œ ë¶„ë¦¬í•œë‹¤.
- ì¼ìë³„ë¡œ ë¶„ë¦¬ëœ ê¸°ê°„ì„ ë‹¤ì‹œ ì‹œê°„ëŒ€ë³„ ê·œì¹™ì— ë”°ë¼ ë¶„ë¦¬í•œ í›„ ê° ê¸°ê°„ì— ëŒ€í•´ ìš”ê¸ˆì„ ê³„ì‚°í•œë‹¤.

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%204.png)

ì˜ˆ) 19ì‹œë¶€í„° 24ì‹œê¹Œì§€ 10ì´ˆë‹¹ 15ì›ì˜ ìš”ê¸ˆì„ ë¶€ê³¼

1ì›” 1ì¼ 10ì‹œë¶€í„° 1ì›” 3ì¼ 15ì‹œê¹Œì§€ 3ì¼ì— ê±¸ì³ í†µí™”

intervals ë³€ìˆ˜ì—ê²Œ splitByDay ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ ë‚ ì§œë³„ë¡œ í†µí™”ì‹œê°„ì„ ë¶„ë¦¬í•œë‹¤.

1ì›” 1ì¼ 10ì‹œ ~ 24ì‹œ, 1ì›” 2ì¼ 0ì‹œ ~ 24ì‹œ, 1ì›” 3ì¼ 0ì‹œ ~ 15ì‹œë¡œ ë¶„ë¦¬í•œë‹¤.

1ì›” 1ì¼ 10ì‹œ ~ 24ì‹œì˜ ê²½ìš° 19ì‹œ ê¸°ì¤€ìœ¼ë¡œ ë‚˜ëˆ  1ì›” 1ì¼ 10ì‹œ ~ 1ì›” 1ì¼ 19ì‹œ, 1ì›” 1ì¼ 19ì‹œ ~ 24ì‹œë¡œ ë‚˜ëˆˆë‹¤.

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%205.png)

ë‚˜ëˆˆ ê²°ê³¼ì´ë‹¤.

```java
public class TimeOfDayDiscountPolicy extends BasicRatePolicy{
	private List<LocalTime> starts = new ArrayList<>();
	private List<LocalTime> ends = new ArrayList<>();
	private List<Duration> durations = new ArrayList<>();
	private List<Money> amount = new ArrayList<>();

	@override
	protected Money calculateCallFee(Call call){
		Money result = Money.ZERO;
		for(DateTimeInterval interval. call.splitByDay()){
			for(int loop = 0; loop < starts.size(); loop++){
				result.plus(amounts.get(loop).times(
					Duration.between(from(interval, starts.get(loop)), to(interval, ends,get(loop)))
						.getSeconds() / durations.get(loop).getSeconds()));
			}
		}
		return result;
	}

	private LocalTime from(DateTimeInterval interval, LocalTime from){
		return interval.getFrom().toLocalTime().isBefore(from) ?
			from : interval getFrom().toLocalTime();
	}

	private LocalTime to(DateTimeInterval interval, LocalTime to){
		return interval.getTo().toLocalTime().isAfter(to) ?
				to: interval.getTo().toLocalTime();
	}
}
```

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%206.png)

ì‹œê°„ëŒ€ë³„ë¡œ ìš”ê¸ˆë°©ì‹ì„ êµ¬ì„±í•˜ëŠ” 4ê°œì˜ ë¦¬ìŠ¤íŠ¸ì´ë‹¤.

```java
public class Call{
	public List<DateTimeInterval> splitByDay(){
		return interval.splitByDay();
	}
}
```

```java
public class DateTimeInterval{
	public List<DateTimeInterval> splitByDay(){
		if(days() > 0){
			return splitByDay(days());
		}
		return Arrays.asList(this);
	}

	private long days(){
		return Duration.between(from.toLocalDate().asStartOfDay(), to.toLocalDate().atStartOfDay())
			.toDays();
	}

	private List<DateTimeInterval> splitByDay(long days){
		List<DateTimeInterval> result = new ArrayList<>();
		addFirstDay(result);
		addMiddleDays(result, days);
		addLastDay(result);
		return result;
	}

	private void addFirstDay(List<DateTimeInterval> result){
		result.add(DateTimeInterval.toMidnight(from));
	}

	pirvate addMiddleDays(List<DateTimeInterval> result, long days){
		for(int loop = 1; loop < days; loop++){
			result.add(DateTimeInterval.during(from.toLocalDate().plusDays(loop)));
		}
	}

	private void addLastDay(List<DateTimeInterval> result){
		result.add(DateTimeInterval.fromMidnight(to));
	} 
}
```

1. ìš”ì¼ë³„ ë°©ì‹ êµ¬í˜„í•˜ê¸°

```java
public class DayOfWeekDiscountRule{
	private List<DayOfWeek> dayOfWeeks = new ArrayList<>();
	private Duration duration = Duration.ZERO;
	private Money amount = Money.ZERO;

	pulbic DayOfWeekDiscountRule(List<DayOfWeek> dayOfWeeks, Duration duration, Money amount){
		this.dayOfWeeks = dayOfWeeks;
		this.duration = duration;
		this.amount = amount;
	}

	public Money calculate(DateTimeInterval interval){
		// ìš”ì¼ ì¡°ê±´ì„ ë§Œì¡±ì‹œí‚¬ ê²½ìš°
		if(dayOfWeeks.contains(interval.getFrom,.getDayOfWeek())){
			return amount.times(interval.duration().getSeconds() / duration.getSecond());
		}
		return Money.ZERO;
	}
}
```

```java

public class DayOfWeekDiscountPolicy extens BasicRatePolicy{
	private List<DayOfWeekDiscountRule> rules = new ArrayList<>();
		
	public DayOfWeekDiscountPolicy(List<DayOfWeekDiscountRule> rules){
		this.rules = rules;
	}

	@override
	protected Money calculateCallFee(Call call){
		Money result = Money.ZERO;
		for(DateTimeInterval interval : call.getInterval().splitByDay()){
			for(DayOfWeekDiscountRule rule: rules){
				result.plus(rule.calculate(interval));
			}
		}
		return result;
	}
}
```

1. êµ¬ê°„ë³„ ë°©ì‹ êµ¬í˜„í•˜ê¸°

```java
public class DurationDiscountRule extends FixedFeePolicy{
	private Duration from;
	private Duration to;

	public DurationDiscountRule(Duration from, Duration to, Money amount, Duration seconds){
		super(amount, seconds);
		this.from = from;
		this.to = to;
	}

	public Money calculate(Call call){
		if(call.getDuration().compareTo(to) > 0){
			return Money.ZERO;
		}
		if(call.getDuration().compareTo(from) < 0){
			return Money.ZERO;
		}

		// ë¶€ëª¨ í´ë˜ìŠ¤ Phoneì˜ í´ë˜ìŠ¤ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ”ë‹¤
		Phone phone = new Phone(null);

		phone.call(new Call(call.getFrom().plus(from),
				call.getDuration().compareTo(to) > 0 ? call.getFrom().plus(to) : 
				call.getTo()));

		return super.calculateFee(phone);
	}
}
```

ì´ì œ ì—¬ëŸ¬ê°œì˜ ë£°ì„ ì´ìš©í•´ í• ì¸ ì •ì±…ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

```java
public class DurationDiscountPolicy extends BasicRatePolicy{
	private List<DurationDiscountRule> rules = new ArrayList<>();

	public DurationDiscountPolicy(List<DurationDiscountRule> rules){
		this,rules = rules;
	}

	@overried
	protected Money calculateCallFee(Call call){
		Money resukt = Money.ZERO;
		for(DurationDiscountRule rule: rules){
			result.plus(rule.calculate(call));
		}
		return result;
	}
}
```

ì´ í´ë˜ìŠ¤ëŠ” í• ì¼ ìš”ê¸ˆ ì •ì±…ì„ ì •ìƒì ìœ¼ë¡œ ê³„ì‚°í•˜ê³  í´ë˜ìŠ¤ í•˜ë‚˜ë‹¹ í•˜ë‚˜ì˜ ì±…ì„ì„ ê°€ì§€ê²Œ í•œë‹¤.

í•˜ì§€ë§Œ ì´ ì„¤ê³„ê°€ í›Œë¥­í•˜ë‹¤ í•  ìˆ˜ ì—†ë‹¤. ì´ìœ ëŠ” ê¸°ì¡´ ì„¤ê³„ê°€ ì–´ë– í•œ ê°€ì´ë“œë„ ì œê³µì„ í•˜ì§€ ì•Šì•„ ê¸°ì¡´ í´ë˜ìŠ¤ì™€ ì¼ê´€ì„±ì´ ë–¨ì–´ì§€ ë•Œë¬¸ì´ë‹¤.

> ì½”ë“œ ì¬ì‚¬ìš©ì„ ìœ„í•œ ìƒì†ì€ í•´ë¡­ë‹¤.
DurationDiscountRule í´ë˜ìŠ¤ê°€ ìƒì†ì„ ì˜ëª» ì‚¬ìš©í•œ ê²½ìš°ë¼ëŠ” ì‚¬ì‹¤ì„ ëˆˆì¹˜ì±˜ì„ ê²ƒì´ë‹¤.
ì´ ì½”ë“œëŠ” ì´í•´í•˜ê¸°ë„ ì–´ë ¤ìš´ë° FixedFeePolicyì˜ calculateFee ë©”ì„œë“œë¥¼ ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•´
DurationDiscountRuleì˜ calculate ë©”ì„œë“œ ì•ˆì— Phoneê³¼ Callì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ”ê²ƒì€ ê½¤ë‚˜ ë¶€ìì—°ìŠ¤ëŸ¬ì›Œ ë³´ì¸ë‹¤. ì´ê²ƒì€ ìƒì†ì„ ìœ„í•´ ì„¤ê³„ëœ í´ë˜ìŠ¤ê°€ ì•„ë‹Œ ì¬ì‚¬ìš©ì„ ìœ„í•´ ì–µì§€ë¡œ ì½”ë“œë¥¼ ë¹„íŠ¼ ê²°ê³¼ì´ë‹¤.
> 

## 2.  ì„¤ê³„ì— ì¼ê´€ì„± ë¶€ì—¬í•˜ê¸°

<aside>
ğŸ”– ê¸°ë³¸ ì§€ì¹¨
1. ë³€í•˜ëŠ” ê°œë…ì„ ë³€í•˜ì§€ ì•ŠëŠ” ê°œë…ìœ¼ë¡œë¶€í„° ë¶„ë¦¬í•˜ë¼.
  ê° ì¡°ê±´ë¬¸ì„ ê°œë³„ì ì¸ ê°ì²´ë¡œ ë¶„ë¦¬í–ˆê³  ì´ ê°ì²´ë“¤ê³¼ ì¼ê´€ì„±ìˆê²Œ í˜‘ë ¥í•˜ê¸° ìœ„í•´ íƒ€ì…ê³„ì¸µì„ êµ¬ì„±í–ˆ  ë‹¤. ê·¸ë¦¬ê³  ì´ íƒ€ì… ê³„ì¸µì˜ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë¶„ë¦¬í•˜ê¸° ìœ„í•´ ì—­í• ì„ ë„ì…í•˜ê³  ìµœì¢…ì ìœ¼ë¡œ ì´ ì—­í• ì„ ì¶”ìƒí´ë˜ìŠ¤ì™€ ì¸í„°í˜ì´ìŠ¤ë¡œ êµ¬í˜„í–ˆë‹¤.

2. ë³€í•˜ëŠ” ê°œë…ì„ ìº¡ìŠí™” í•´ë¼
  Movieë¡œ ë¶€í„° í• ì¸ ì •ì±…ì„ ë¶„ë¦¬í•œ í›„ ì¶”ìƒ í´ë˜ìŠ¤ì¸ DiscountPolicyë¥¼ ë¶€ëª¨ë¡œ ì‚¼ì•„ ìƒì† ê³„ì¸µì„ êµ¬ì„±í•œ ì´ìœ ê°€ ë°”ë¡œ Movieë¡œ ë¶€í„° êµ¬ì²´ì ì¸ í• ì¸ ì •ì±…ë“¤ì„ ìº¡ìŠí™” í•˜ê¸° ìœ„í•´ì„œë‹¤.

</aside>

ì¡°ê±´ ë¡œì§ ëŒ€ ê°ì²´ íƒìƒ‰

```java
public class ReservationAgency{
	public Reservation reserve(Screening screening, Customer customer, int audienceCount){
		for(DiscountCondition conition : movie.getDiscountConditions()){
			if(condition.getType() == DiscountConditionType.PERIOD){
				// ê¸°ê°„ ì¡°ê±´ì¸ ê²½ìš°
			}else{
				// íšŒì°¨ ì¡°ê±´ì¸ ê²½ìš°
			}
		}

		if(discountable){
			switch(movie.getMovieType()){
				case AMOUNT_DISCOUNT : 
					// ê¸ˆì•¡ í• ì¸ ì •ì±…ì¸ ê²½ìš°
				case PERCENT_DISCOUNT : 
					// ë¹„ìœ¨ í• ì¸ ì •ì±…ì¸ ê²½ìš°
				case NONE_DISCOUNT :
					// í• ì¸ ì •ì±…ì´ ì—†ëŠ” ê²½ìš°
			}
		}else{
			// í• ì¸ ì ìš©ì´ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°
		}
	}
}
```

ìœ„ ì½”ë“œëŠ” ì¶”ê°€ ì‚¬í•­ì´ ìˆë‹¤ë©´ ìƒˆë¡œìš´ elseì ˆì´ë‚˜ caseë¥¼ ì¶”ê°€ í• ê²ƒì´ë‹¤.

ê°ì²´ì§€í–¥ì€ ì¡°ê¸ˆ ë‹¤ë¥¸ ì ‘ê·¼ë°©ë²•ì„ ì·¨í•œë‹¤

```java
public class Movie{
	private DiscountPolicy discountPolicy;

	public Money calculateMovieFee(Screening screening){
		return fee.minus(discountPolicy.calculateDiscountAmount(screening));
	}
}
```

ë‹¤í˜•ì„±ì€ ë°”ë¡œ ì´ëŸ° ì¡°ê±´ ë¡œì§ì„ ê°ì²´ ì‚¬ì´ì˜ ì´ë™ìœ¼ë¡œ ë°”ê¾¸ê¸° ìœ„í•´ ê°ì²´ì§€í–¥ì´ ì œê³µí•˜ëŠ” ì„¤ê³„ ê¸°ë²•ì´ë‹¤.

```java
public abstract class DiscountPolicy{
	private List<DiscountCondition> conditions = new ArrayList<>();

	public Money calculateDIscountAmount(Screening screening){
		for(DiscoountCondition each: conditions){
			if(each.isSatisfiedBy(screening)){
				return getDiscountAmount(screening);
			}
		}
		return screening.getMovieFee();
	}
}
```

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%207.png)

í•˜ì§€ë§Œ í˜‘ë ¥ì— ì°¸ì—¬í•˜ëŠ” ì£¼ì²´ëŠ” êµ¬ì²´ì ì¸ ê°ì²´ì´ë‹¤. ì´ ê°ì²´ë“¤ì€ í˜‘ë ¥ ì•ˆì—ì„œ DiscountPlicyì™€ DiscountConditionì„ ëŒ€ì²´í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%208.png)

ì¸í„°í˜ì´ìŠ¤ë¥¼ ì´ìš©í•´ ì´ íƒ€ì… ê³„ì¸µì„ êµ¬í˜„í•œ ê²ƒì´ë‹¤.

ê°ì²´ ì‚¬ì´ì˜ ì´ë™ìœ¼ë¡œ ëŒ€ì²´í•˜ê¸° ìœ„í•´ì„œëŠ” ì»¤ë‹¤ë€ í´ë˜ìŠ¤ë¥¼ ë” ì‘ì€ í´ë˜ìŠ¤ë“¤ë¡œ ë¶„ë¦¬í•´ì•¼ í•œë‹¤. ê·¸ë ‡ê²Œ í•˜ê¸° ìœ„í•´ ì–´ë–¤ ê¸°ì¤€ì„ ë”°ë¥´ëŠ”ê²Œ ì¢‹ì„ê¹Œ? ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€ ë³€ê²½ì˜ ì´ìœ ì™€ ì£¼ê¸°ì´ë‹¤. í´ë˜ìŠ¤ëŠ” ëª…í™•íˆ ë‹¨ í•˜ë‚˜ì˜ ì´ìœ ì— ì˜í•´ì„œë§Œ ë³€ê²½ ë˜ì–´ì•¼ í•˜ê³  í´ë˜ìŠ¤ ì•ˆì˜ ëª¨ë“  ì½”ë“œëŠ” í•¨ê»˜ ë³€ê²½ ë˜ì–´ì•¼ í•œë‹¤. ê°„ë‹¨íˆ ë§í•´ ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ë”°ë¥´ë„ë¡ í´ë˜ìŠ¤ë¥¼ ë¶„ë¦¬í•´ì•¼ í•œë‹¤.

ì‘ì€ í´ë˜ìŠ¤ë¡œ ë³€ê²½ì„ í•˜ë©´ ì¼ê´€ì„±ì„ ì§€í‚¤ê¸° ìˆ˜ì›”í•´ì§„ë‹¤.

ìº¡ìŠí™” ë‹¤ì‹œ ì‚´í´ë³´ê¸°

ìº¡ìŠí™”ëŠ” ë°ì´í„° ì€ë‹‰ì´ ì•„ë‹ˆë‹¤. ì†Œí”„íŠ¸ì›¨ì–´ ì•ˆì—ì„œ ë³€í• ìˆ˜ ìˆëŠ” ëª¨ë“  ê°œë…ì„ ê°ì¶”ëŠ” ê²ƒì´ë‹¤.

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%209.png)

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%2010.png)

**ë°ì´í„° ìº¡ìŠí™”** : Movie í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ titleì˜ ê°€ì‹œì„±ì€ privateì´ê¸° ë•Œë¬¸ì— ì™¸ë¶€ì—ì„œ ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤. ì´ ì†ì„±ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ìœ ì¼í•œ ë°©ë²•ì€ ë©”ì„œë“œë¥¼ ì´ìš©í•˜ëŠ”ê²ƒ ë¿ì´ë‹¤. **ë‹¤ì‹œë§í•´ í´ë˜ìŠ¤ëŠ” ë‚´ë¶€ì— ê´€ë¦¬í•˜ëŠ” ë°ì´í„°ë¥¼ ìº¡ìŠí™” í•œë‹¤.**

**ë©”ì„œë“œ ìº¡ìŠí™”** : DiscountPolicy í´ë˜ìŠ¤ì—ì„œ ì •ì˜ë¼ ìˆëŠ” getDiscountAmount ë©”ì„œë“œì˜ ê°€ì‹œì„±ì€ protectedë‹¤. í´ë˜ìŠ¤ì˜ ì™¸ë¶€ì—ì„œëŠ” ì´ ë©”ì„œë“œì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ì—†ê³  í´ë˜ìŠ¤ ë‚´ë¶€ì™€ ì„œë¸Œí´ë˜ìŠ¤ì—ì„œë§Œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤. ë”°ë¼ì„œ í´ë˜ìŠ¤ ì™¸ë¶€ì— ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šê³  ë©”ì„œë“œë¥¼ ìˆ˜ì •í• ìˆ˜ ìˆë‹¤. ë‹¤ì‹œë§í•´ í´ë˜ìŠ¤ ë‚´ë¶€ í–‰ë™ì„ ìº¡ìŠí™” í•˜ê³  ìˆëŠ”ê²ƒì´ë‹¤.

**ê°ì²´ ìº¡ìŠí™”** : Movie í´ë˜ìŠ¤ëŠ” DiscountPolicy íƒ€ì…ì˜ ì¸ìŠ¤í„´ë¸Œ ë³€ìˆ˜ discountPolicyë¥¼ í¬í•¨í•œë‹¤. ì´ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ëŠ” private ê°€ì‹œì„±ì„ ê°€ì§€ê¸° ë•Œë¬¸ì— Movieì™€ DiscountPolicy ì‚¬ì´ì˜ ê´€ê³„ë¥¼ ë³€ê²½í•˜ë”ë¼ë„ ì™¸ë¶€ì—ëŠ” ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•ŠëŠ”ë‹¤. ë‹¤ì‹œ ë§í•´ì„œ ê°ì²´ì™€ ê°ì²´ ì‚¬ì´ì˜ ê´€ê³„ë¥¼ ìº¡ìŠí™” í•œë‹¤. ëˆˆì¹˜ê°€ ë¹ ë¥¸ ì‚¬ëŒì´ë¼ë©´ ê°ì²´ ìº¡ìŠí™”ê°€ í•©ì„±ì„ ì˜ë¯¸ í•œë‹¤ëŠ”ê²ƒì„ ëˆˆì¹˜ ì±˜ì„ ê²ƒì´ë‹¤.

**ì„œë¸Œíƒ€ì… ìº¡ìŠí™”** : MovieëŠ” DiscountPolicyì— ëŒ€í•´ì„œëŠ” ì•Œê³ ìˆì§€ë§Œ AmountDiscountPolicyì™€ PercentDIscountPolicyì— ëŒ€í•´ì„œëŠ” ì•Œì§€ ëª»í•œë‹¤. ê·¸ëŸ¬ë‚˜ ì‹¤ì œë¡œ ì‹¤í–‰ ì‹œì ì—ëŠ” ì´ í´ë˜ìŠ¤ë“¤ì˜ ì¸ìŠ¤í„´ìŠ¤ì™€ í˜‘ë ¥í•  ìˆ˜ ìˆë‹¤. ì´ê²ƒì€ ê¸°ë°˜ í´ë˜ìŠ¤ì¸ DiscountPolicyì™€ì˜ ì¶”ìƒì ì¸ ê´€ê³„ê°€ AmountDiscountPolicyì™€ PercentDiscountPolicyì˜ ì¡´ì¬ë¥¼ ê°ì¶”ê³  ìˆê¸° ë•Œë¬¸ì´ë‹¤. ë‹¤ì‹œ ë§í•´ ì„œë¸Œíƒ€ì…ì˜ ì¢…ë¥˜ë¥¼ ìº¡ìŠí™” í•˜ê³  ìˆëŠ”ê²ƒì´ë‹¤. ëˆˆì¹˜ê°€ ë¹ ë¥¸ ì‚¬ëŒì´ë¼ë©´ ì„œë¸Œíƒ€ì… ìº¡ìŠí™”ê°€ ë‹¤í˜•ì„±ì˜ ê¸°ë°˜ì´ ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

ë‹¤ì–‘í•œ ìº¡ìŠí™” ë°©ë²•ì´ ì¡´ì¬í•˜ì§€ë§Œ ì¼ê´€ì„±ìˆê²Œ ë§Œë“¤ê¸° ìœ„í•´ ê°€ì¥ ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ì„œë¸Œíƒ€ì…ìº¡ìŠí™”ì™€ ê°ì²´ ìº¡ìŠí™”ë¥¼ ì¡°í•©í•˜ëŠ” ê²ƒì´ë‹¤. ( ìœ„ ì‚¬ì§„ )

ë³€ê²½ì˜ ì´ìœ ì— ë”°ë¼ ìº¡ìŠí™” í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì´ ê¶ê¸ˆí•˜ë‹¤ë©´ ë””ìì¸ íŒ¨í„´ì„ ì‚´í´ë³´ê¸¸ ë°”ë€ë‹¤.

## 3. ì¼ê´€ì„± ìˆëŠ” ê¸°ë³¸ ì •ì±… êµ¬í˜„í•˜ê¸°

### ë³€ê²½ ë¶„ë¦¬í•˜ê¸°

ì¼ê´€ì„± ìˆëŠ” í˜‘ë ¥ì„ ë§Œë“¤ê¸° ìœ„í•œ ì²« ë‹¨ê³„: ë³€í•˜ëŠ” ê°œë…ê³¼ ë³€í•˜ì§€ ì•ŠëŠ” ê°œë… ë¶„ë¦¬

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%2011.png)

ì•ì—ì„œ êµ¬í˜„í•œ í†µí™” ìš”ê¸ˆ ê³¼ê¸ˆ ì •ì±…ì„ ìœ„ì™€ê°™ì´ ì •ë¦¬í•  ìˆ˜ ìˆë‹¤.

- ê¸°ë³¸ ì •ì±…ì€ í•œ ê°œ ì´ìƒì˜ ê·œì¹™ìœ¼ë¡œ êµ¬ì„±ëœë‹¤.
- í•˜ë‚˜ì˜ ê·œì¹™ì€ ì ìš©ì¡°ê±´ê³¼ ë‹¨ìœ„ìš”ê¸ˆì˜ ì¡°í•©ì´ë‹¤.

ì´ ì •ë¦¬ì—ì„œ ë³€í•˜ëŠ” ê°œë…ê³¼ ë³€í•˜ì§€ ì•ŠëŠ” ê°œë…ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤.

- ë³€í•˜ëŠ” ê°œë…: ì ìš© ì¡°ê±´
- ë³€í•˜ì§€ ì•ŠëŠ” ê°œë…: ê·œì¹™

### ë³€ê²½ ìº¡ìŠí™” í•˜ê¸°

í˜‘ë ¥ì„ ì¼ê´€ì„± ìˆê²Œ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ë³€ê²½ì„ ìº¡ìŠí™” í•´ì„œ íŒŒê¸‰íš¨ê³¼ë¥¼ ì¤„ì—¬ì•¼ í•œë‹¤.

ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ â€˜ê·œì¹™â€™ ì—ì„œ ë³€í•˜ëŠ” ë¶€ë¶„ â€˜ì ìš© ì¡°ê±´â€™(ë³€ê²½)ì„ ë¶„ë¦¬í•´ì„œ ì¶”ìƒí™” í•œ í›„ ì‹œê°„ëŒ€ë³„, ìš”ì¼ë³„, êµ¬ê°„ë³„ ë°©ì‹ì„ ì¶”ìƒí™”ì˜ ì„œë¸Œíƒ€ì…ìœ¼ë¡œ ë§Œë“ ë‹¤. (ì„œë¸Œíƒ€ì… ìº¡ìŠí™”)

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%2012.png)

- ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„: BasicRatePolicy, FeeRule, FeeCondition
- ë³€í•˜ëŠ” ë¶€ë¶„: TimeOfDayFeeCondition, DayOfWeekFeeCondition, DurationFeeCondition

ë³€í•˜ëŠ” ë¶€ë¶„ì´ FeeConditionìœ¼ë¡œ ìº¡ìŠí™”ë¨

### í˜‘ë ¥ íŒ¨í„´ ì„¤ê³„í•˜ê¸°

ì¶”ìƒí™”ë§Œìœ¼ë¡œ í˜‘ë ¥ì„ í•˜ë©´ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í˜‘ë ¥ íŒ¨í„´ì´ ëœë‹¤.

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%2013.png)

BasicRatePolicyê°€ FeeRuleì—ì„œ ìš”ê¸ˆì„ ê³„ì‚°í•˜ë¼ëŠ” ë©”ì‹œì§€ë¥¼ ìš”ì²­í•¨ìœ¼ë¡œì„œ í˜‘ë ¥ì´ êµ¬ì„±ëœë‹¤.

FeeRuleì€ í•˜ìœ„ì˜ FeeConditionë“¤ì—ê²Œ ìš”ê¸ˆ ê³„ì‚°ì— í•„ìš”í•œ ì‹œê°„ êµ¬ê°„ì„ ìš”ì²­í•œë‹¤.

### ì¶”ìƒí™” ìˆ˜ì¤€ì—ì„œ í˜‘ë ¥ íŒ¨í„´ ì„¤ê³„í•˜ê¸°

1. ì ìš©ì¡°ê±´ì„ í‘œí˜„í•˜ëŠ” ì¶”ìƒí™” ì¸í„°í˜ì´ìŠ¤
    
    ```java
    public interface FeeCondition {
        List<DateTimeInterval> findTimeIntervals(Call call);
    }
    ```
    
2. ë‹¨ìœ„ìš”ê¸ˆ ê³¼ ì ìš©ì¡°ê±´ ì„ ì €ì¥í•˜ê³  ìš”ê¸ˆì„ ê³„ì‚°í•˜ëŠ” í´ë˜ìŠ¤
    
    ```java
    public class FeeRule {
        private FeeCondition feeCondition;
        private FeePerDuration feePerDuration;
    
        public FeeRule(FeeCondition feeCondition, FeePerDuration feePerDuration) {
            this.feeCondition = feeCondition;
            this.feePerDuration = feePerDuration;
        }
    
        public Money calculateFee(Call call) {
            return feeCondition.findTimeIntervals(call)
                    .stream()
                    .map(each -> feePerDuration.calculate(each))
                    .reduce(Money.ZERO, (first, second) -> first.plus(second));
        }
    }
    ```
    
3. ì¼ì • ê¸°ê°„ë™ì•ˆì˜ ìš”ê¸ˆì„ ê³„ì‚°í•˜ëŠ” ë‹¨ìœ„ ì‹œê°„ë‹¹ ìš”ê¸ˆ í´ë˜ìŠ¤
    
    ```java
    public class FeePerDuration {
        private Money fee;
        private Duration duration;
    
        public FeePerDuration(Money fee, Duration duration) {
            this.fee = fee;
            this.duration = duration;
        }
    
        public Money calculate(DateTimeInterval interval) {
            return fee.times(Math.ceil((double)interval.duration().toNanos() / duration.toNanos()));
        }
    }
    ```
    
4. í˜‘ë ¥ì˜ ì‹œì‘ì ì¸ ê¸°ë³¸ ìš”ê¸ˆ ì •ì±…
    
    ```java
    public final class BasicRatePolicy implements RatePolicy {
        private List<FeeRule> feeRules = new ArrayList<>();
    
        public BasicRatePolicy(FeeRule ... feeRules) {
            this.feeRules = Arrays.asList(feeRules);
        }
    
        @Override
        public Money calculateFee(Phone phone) {
            return phone.getCalls()
                    .stream()
                    .map(call -> calculate(call))
                    .reduce(Money.ZERO, (first, second) -> first.plus(second));
        }
    
        private Money calculate(Call call) {
            return feeRules
                    .stream()
                    .map(rule -> rule.calculateFee(call))
                    .reduce(Money.ZERO, (first, second) -> first.plus(second));
        }
    }
    ```
    

ìœ„ í´ë˜ìŠ¤/ì¸í„°í˜ì´ìŠ¤ë“¤ì€ ë³€í•˜ì§€ ì•ŠëŠ” ì¶”ìƒí™”ë‹¤.

ì´ ìš”ì†Œë“¤ì˜ ì¡°í•©ìœ¼ë¡œ ì „ì²´ì ì¸ í˜‘ë ¥ êµ¬ì¡°ê°€ ì™„ì„±ëœë‹¤.

ë³€í•˜ì§€ ì•ŠëŠ” ì¶”ìƒì ì¸ ìš”ì†Œë§Œìœ¼ë¡œ ìš”ê¸ˆ ê³„ì‚°ì— í•„ìš”í•œ í˜‘ë ¥ êµ¬ì¡°ë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤.

ì‹¤ì œë¡œ ë™ì‘í•˜ë ¤ë©´ ì¸í„°í˜ì´ìŠ¤(FeeCondition)ë¥¼ êµ¬í˜„í•˜ëŠ” êµ¬ì²´ì ì¸ í´ë˜ìŠ¤ê°€ í•„ìš”í•˜ë‹¤.

### êµ¬ì²´ì ì¸  í˜‘ë ¥ êµ¬í˜„í•˜ê¸°

- (DateTimeInterval, ì°¸ê³ ìš©ìœ¼ë¡œ ì¶”ê°€)
    
    ```java
    public class DateTimeInterval {
        private LocalDateTime from;
        private LocalDateTime to;
    
        public static DateTimeInterval of(LocalDateTime from, LocalDateTime to) {
            return new DateTimeInterval(from, to);
        }
    
        public static DateTimeInterval toMidnight(LocalDateTime from) {
            return new DateTimeInterval(from, LocalDateTime.of(from.toLocalDate(), LocalTime.of(23, 59, 59, 999_999_999)));
        }
    
        public static DateTimeInterval fromMidnight(LocalDateTime to) {
            return new DateTimeInterval(LocalDateTime.of(to.toLocalDate(), LocalTime.of(0, 0)), to);
        }
    
        public static DateTimeInterval during(LocalDate date) {
            return new DateTimeInterval(
                    LocalDateTime.of(date, LocalTime.of(0, 0)),
                    LocalDateTime.of(date, LocalTime.of(23, 59, 59, 999_999_999)));
        }
    
        private DateTimeInterval(LocalDateTime from, LocalDateTime to) {
            this.from = from;
            this.to = to;
        }
    
        public Duration duration() {
            return Duration.between(from, to);
        }
    
        public LocalDateTime getFrom() {
            return from;
        }
    
        public LocalDateTime getTo() {
            return to;
        }
    
        public List<DateTimeInterval> splitByDay() {
            if (days() > 0) {
                return split(days());
            }
    
            return Arrays.asList(this);
        }
    
        private long days() {
            return Duration.between(from.toLocalDate().atStartOfDay(), to.toLocalDate().atStartOfDay()).toDays();
        }
    
        private List<DateTimeInterval> split(long days) {
            List<DateTimeInterval> result = new ArrayList<>();
            addFirstDay(result);
            addMiddleDays(result, days);
            addLastDay(result);
            return result;
        }
    
        private void addFirstDay(List<DateTimeInterval> result) {
            result.add(DateTimeInterval.toMidnight(from));
        }
    
        private void addMiddleDays(List<DateTimeInterval> result, long days) {
            for(int loop=1; loop < days; loop++) {
                result.add(DateTimeInterval.during(from.toLocalDate().plusDays(loop)));
            }
        }
    
        private void addLastDay(List<DateTimeInterval> result) {
            result.add(DateTimeInterval.fromMidnight(to));
        }
    
        public String toString() {
            return "[ " + from + " - " + to + " ]";
        }
    }
    ```
    

1. ì‹œê°„ëŒ€ë³„ ì •ì±…
    
    ```java
    public class TimeOfDayFeeCondition implements FeeCondition {
        private LocalTime from;
        private LocalTime to;
    
        public TimeOfDayFeeCondition(LocalTime from, LocalTime to) {
            this.from = from;
            this.to = to;
        }
    
        @Override  // ì‹œê°„ëŒ€ë³„ ì •ì±…ìœ¼ë¡œ ìš”ê¸ˆ êµ¬ê°„ì„ ê³„ì‚°
        public List<DateTimeInterval> findTimeIntervals(Call call) {
            return call.getInterval().splitByDay()
                    .stream()
                    .filter(each -> from(each).isBefore(to(each)))
                    .map(each -> DateTimeInterval.of(
                                    LocalDateTime.of(each.getFrom().toLocalDate(), from(each)),
                                    LocalDateTime.of(each.getTo().toLocalDate(), to(each))))
                    .collect(Collectors.toList());
        }
    
        private LocalTime from(DateTimeInterval interval) {
            return interval.getFrom().toLocalTime().isBefore(from) ?
                    from : interval.getFrom().toLocalTime();
        }
    
        private LocalTime to(DateTimeInterval interval) {
            return interval.getTo().toLocalTime().isAfter(to) ?
                    to : interval.getTo().toLocalTime();
        }
    }
    
    ```
    
2. ìš”ì¼ë³„ ì •ì±…
    
    ```java
    public class DayOfWeekFeeCondition implements FeeCondition {
        private List<DayOfWeek> dayOfWeeks = new ArrayList<>();
    
        public DayOfWeekFeeCondition(DayOfWeek ... dayOfWeeks) {
            this.dayOfWeeks = Arrays.asList(dayOfWeeks);
        }
    
        @Override
        public List<DateTimeInterval> findTimeIntervals(Call call) {
            return call.getInterval()
                    .splitByDay()
                    .stream()
                    .filter(each ->
                            dayOfWeeks.contains(each.getFrom().getDayOfWeek()))
                    .collect(Collectors.toList());
        }
    }
    ```
    
3. êµ¬ê°„ë³„ ì •ì±…
    
    ```java
    public class DurationFeeCondition implements FeeCondition {
        private Duration from;
        private Duration to;
    
        public DurationFeeCondition(Duration from, Duration to) {
            this.from = from;
            this.to = to;
        }
    
        @Override
        public List<DateTimeInterval> findTimeIntervals(Call call) {
            if (call.getInterval().duration().compareTo(from) < 0) {
                return Collections.emptyList();
            }
    
            return Arrays.asList(DateTimeInterval.of(
                    call.getInterval().getFrom().plus(from),
                    call.getInterval().duration().compareTo(to) > 0 ?
                            call.getInterval().getFrom().plus(to) :
                            call.getInterval().getTo()));
        }
    }
    ```
    

ë³€í•˜ëŠ” ë¶€ë¶„ì„ ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì—ì„œ ë³€ê²½í•¨ìœ¼ë¡œ ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ (BasicRatePolicy, FeePerDuration, FeeRule) ì€ ì¬ì‚¬ìš©í•˜ë©´ì„œ ë³€í•˜ëŠ” ë¶€ë¶„ (xxxxFeeCondition) ì„ í™•ì¥í•  ìˆ˜ ìˆë‹¤.

ì¼ê´€ì„± ìˆëŠ” í˜‘ë ¥ì€ ê°œë°œìì—ê²Œ í™•ì¥ í¬ì¸íŠ¸ (FeeCondition)ë¥¼ ê°•ì œí•˜ê¸° ë•Œë¬¸ì— ì •í•´ì§„ êµ¬ì¡°ë¥¼ ìš°íšŒí•˜ê¸° ì–´ë µê²Œ ë§Œë“ ë‹¤.

ê°œë°œìëŠ” ì½”ë“œì˜ í˜•íƒœë¡œ ì£¼ì–´ì§„ ì œì•½ ì•ˆì— ë¨¸ë¬¼ëŸ¬ì•¼ í•˜ì§€ë§Œ ì‘ì€ ë¬¸ì œì— ì§‘ì¤‘í•  ìˆ˜ ìˆëŠ” ììœ ë¥¼ ì–»ëŠ”ë‹¤.

ì´ë ‡ê²Œ ì¼ê´€ëœ êµ¬ì¡°ëŠ” í˜‘ë ¥ íŒ¨í„´ì„ ì´í•´í•˜ê¸°ë§Œ í•˜ë©´ ë³€í•˜ëŠ” ë¶€ë¶„ë§Œ ë”°ë¡œ ë–¼ì–´ë‚´ì–´ ë…ë¦½ì ìœ¼ë¡œ ì´í•´í•˜ë”ë¼ë„ ì „ì²´ì ì¸ êµ¬ì¡°ë¥¼ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆë‹¤.

### í˜‘ë ¥ íŒ¨í„´ ë§ì¶”ê¸°

ê³ ì • ìš”ê¸ˆ ì •ì±…ì€ ê·œì¹™ì´ë¼ëŠ” ê°œë…ì´ í•„ìš”ì—†ë‹¤.

í•˜ì§€ë§Œ ê¸°ì¡´ì˜ í˜‘ë ¥ ë°©ì‹ì„ ë²—ì–´ë‚˜ëŠ”ê²ƒë³´ë‹¤ëŠ” ì¡°ê¸ˆ ì´ìƒí•˜ë”ë¼ë„ ì „ì²´ì ì¸ ì¼ê´€ì„±ì„ ìœ ì§€í• ìˆ˜ ìˆëŠ” ì„¤ê³„ë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í•˜ë©´, ì¡°ê¸ˆ ì´ìƒí•˜ì§€ë§Œ ê¸°ì¡´ì˜ í˜‘ë ¥ë°©ì‹ì„ ë”°ë¥´ê²Œ í•  ìˆ˜ ìˆë‹¤.

```java
public class FixedFeeCondition implements FeeCondition {
    @Override
    public List<DateTimeInterval> findTimeIntervals(Call call) {
        return Arrays.asList(call.getInterval());
    }
}
```

ê°œë…ì  ë¬´ê²°ì„±(ì¼ê´€ì„±)ì„ ë¬´ë„ˆëœ¨ë¦¬ëŠ”ê²ƒë³´ë‹¤ ì´ ë°©ë²•ì´ í›¨ì”¬ ì¢‹ë‹¤.

### ê²°ê³¼

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%2014.png)

![Untitled](Chapter%2014%20%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%80%E1%85%AA%E1%86%AB%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%20166ebc53a3844a5ca06b00edad5ecbbe/Untitled%2015.png)