# 8장 통합점: 게이트웨이, 터널, 릴레이

## 게이트웨이

- 게이트웨이는 리소스를 한 개의 애플리케이션으로만 처리하기 힘들어지면서
인터프리터와 비슷하게 리소스를 받기 위한 경로를 안내하는 목적으로 고안된
HTTP 인터페이스다.
- 리소스와 애플리케이션을 연결하는 역할을 하며,
HTTP 트래픽을 타 프로토콜로 변환해 클라이언트가 프로토콜을 알지 못해도
서버에 접근할 수 있도록 도와주기도 한다.

## 프로토콜 게이트웨이

- 클라이언트는 명시적으로 게이트웨이를 통해 HTTP 트래픽을 보낼 수 있다.
- HTTP/*: 서버 측 웹 게이트웨이
    - 서버 측 웹 게이트웨이는 클라이언트로부터 HTTP 요청이
    서버 영역으로 들어오는 시점에 HTTP 요청을 외래 프로토콜로 전환한다.
        
        ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%90%E1%85%A9%E1%86%BC%E1%84%92%E1%85%A1%E1%86%B8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%B3%E1%84%8B%E1%85%B0%E1%84%8B%E1%85%B5,%20%E1%84%90%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF,%20%E1%84%85%E1%85%B5%E1%86%AF%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%20725e93ff39394724aafbb803b99d24b7/Untitled.png)
        
- HTTP/HTTPS: 서버 측 보안 게이트웨이
    - 클라이언트가 보낸 HTTP 요청을 게이트웨이가 자동으로 HTTPS 로 암호화한다.
- HTTPS/HTTP: 클라이언트 측 보안 게이트웨이
    - 클라이언트의 HTTPS 요청을 게이트웨이가 자동으로 복호화해
    웹 서버로 HTTP 요청을 보낸다.

## 리소스 게이트웨이

- 가장 일반적인 형태의 게이트웨이는 목적지 서버와 게이트웨이를 한 개의 서버로 결합한
애플리케이션 서버다.
    
    ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%90%E1%85%A9%E1%86%BC%E1%84%92%E1%85%A1%E1%86%B8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%B3%E1%84%8B%E1%85%B0%E1%84%8B%E1%85%B5,%20%E1%84%90%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF,%20%E1%84%85%E1%85%B5%E1%86%AF%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%20725e93ff39394724aafbb803b99d24b7/Untitled%201.png)
    
- 공용 게이트웨이 인터페이스 CGI
    - 단순히 요청을 받고 처리해 응답하는 CGI 는 최초의 애플리케이션 서버 확장이자
    지금까지 널리 사용되고 있는 인터페이스다.
    - CGI 의 내부 동작을 숨겨 다양한 확장으로부터 서버를 보호한다.
    - CGI 는 프로세스 분리에 따른 성능 비용이 발생하는데
    이 문제를 피하고자 Fast CGI가 개발되었다.
    
    데몬 프로세스로 동작함으로써 요청마다 새로운 프로세스를 만들고 제거하면서
    생기는 성능 비용을 해결했다.
- 서버 확장 API
    - 서버 자체의 동작을 변경하거나 서버 처리능력을 최대치로 끌어올리고자 할 때
    웹 개발자가 자신의 모듈을 HTTP 와 직접 연결할 수 있는 강력한 인터페이스인
    서버 확장 API 를 제공한다.
    - 프로그래머가 자신의 코드를 서버에 연결하거나 서버의 컴포넌트를 교체할 수 있다.

## 터널

- 터널은 HTTP 를 지원하지 않는 애플리케이션에 HTTP 애플리케이션을 사용해 접근한다.
- CONNECT로 HTTP 터널 커넥션 맺기
    - 웹 터널은 HTTP의 CONNECT 메서드를 사용해 목적 서버와 TCP 커넥션을 맺고
    클라이언트와 서버 간 오가는 데이터를 무조건 전달하기를 요청한다.
        
        ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%90%E1%85%A9%E1%86%BC%E1%84%92%E1%85%A1%E1%86%B8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%B3%E1%84%8B%E1%85%B0%E1%84%8B%E1%85%B5,%20%E1%84%90%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF,%20%E1%84%85%E1%85%B5%E1%86%AF%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%20725e93ff39394724aafbb803b99d24b7/Untitled%202.png)
        
        - CONNECT 요청은 시작줄을 제외하고 다른 HTTP 메서드들과 동일하고,
        응답은 기본적으로 Content-Type 헤더가 없는 Connection Established 로 기술된다.
- 데이터 터널링, 시간, 커넥션 관리
    - 터널을 통해 전달되는 데이터는 게이트웨이에서 볼 수 없어 게이트웨이는 패킷의 순서나 흐름에 대한 가정을 할 수 없다.
    - 터널은 커넥션으로부터 언제든 패킷을 받을 준비를 해야하고
    데이터를 즉시 전달해야한다. 만약, 터널 한쪽에서 데이터를 소비하지 않는다면
    다른 한쪽의 터널의 데이터 생산자는 행에 걸려 결국 교착상태가 일어난다.
    - 터널링을 사용하다 커넥션이 끊어지는 경우 한 쪽의 전송하지 않은 데이터는 버려진다.
- SSL 터널링
    - 웹 터널은 원래 방화벽을 통해 암호화된 SSL 트래픽을 전달하려고 개발되었다.
    하지만 낡은 방식의 프락시에서는 SSL 같이 암호화된 프로토콜을 처리하지 못한다.
    - 터널링을 사용하면 SSL 트래픽을 HTTP 커넥션으로 전송해 방화벽을 통과시킬 수 있다.
- 터널 인증
    - 프락시 인증 기능으로 터널에서 클라이언트의 권한을 검사하는 용도로 사용할 수 있다.
- 터널 보안에 대한 고려사항들
    - 터널 게이트웨이는 통신하고 있는 프로토콜이 터널을 올바르게 사용하고 있는지
    검증할 방법이 없다. 이처럼 터널의 오용을 최소화하기 위해
    게이트웨이는 특정 포트만을 터널링할 수 있도록 정책과 함께 사용해야한다.

## 릴레이

- 릴레이는 HTTP 명세를 완전히 준수하지 않는 간단한 HTTP 프락시로
쉽게 구현이 가능하다는 장점을 가지고 있다.
- 단순한 데이터 전송만을 고려한 프락시이며,
데이터 필터링이나 콘텐츠 변환에 사용되기도 한다.
- 멍청한 프록시 문제와 같은 HTTP 명세를 준수하지 않아
발생할 수 있는 문제점들을 내포하고 있다.
이러한 문제점을 예방하기 위해 HTTP 를 제대로 준수하는 프락시를 사용하는걸 추천한다.