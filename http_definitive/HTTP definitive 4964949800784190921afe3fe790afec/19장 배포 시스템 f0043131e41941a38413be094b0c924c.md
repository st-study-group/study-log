# 19장 배포 시스템

### 배포 지원을 위한 FrontPage 서버 확장

- FrontPage 서버 확장
    - 어디서든 배포한다라는 전략의 하나로 MS에서 FPSE(FrontPage 서버 확장) 이라는
    서버 측 소프트웨어 제품을 출시했다.
    - 서버 측 컴포넌트는 웹 서버와 통합되어 웹 사이트와 FrontPage를 구동시키는
    클라이언트 사이에서 필요한 변환 작업을 수행한다.
    - FrontPage 배포 프로토콜은 HTTP POST 요청 위에 RPC 계층을 구현했다.
    이를 이용하면 웹 사이트의 문서를 갱신하고, 검색, 개발자 간 공동 작업을 할 수 있게
    FrontPage 클라이언트가 서버에 명령을 보낼 수 있다.
        
        ![Untitled](19%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A6%E1%86%B7%20f0043131e41941a38413be094b0c924c/Untitled.png)
        
- FrontPage 용어
    - 가상 서버
        - 웹 서버 하나에 웹 사이트 여러 개를 호스팅해 각 사이트가
        자체 전용 서버가 있는 것 처럼 보이게 한다.
        - 가상 서버를 지원하는 웹 서버를 다중 호스팅 웹 서버라고 하고,
        여러 개의 IP 주소로 구성된 장비는 다중 홈 서버라 부른다.
    - 루트 웹
        - 웹 서버의 최상위 콘텐츠 디렉터리거나
        다중 호스팅 환경에서 가상 웹 서버의 최상위 콘텐츠 디렉터리다.
        - 웹 서버에는 오직 한 개의 루트 웹만 존재한다.
    - 서브 웹
        - 루트 웹의 하위 디렉터리거나
        완전한 FPSE 확장 웹인 다른 서브 웹의 하위 디렉터리다.
        - 관리나 저작의 권한을 자체적으로 제한하는 완전한 독립적 엔터티가 될 수 있다.
- FrontPage RPC 프로토콜
    - FrontPage 클라이언트와 FPSE는 자체 RPC 프로토콜을 사용해 통신한다.
    이 프로토콜은 RPC 메서드와 변수를 POST 요청의 본문에 기술해 HTTP POST를 감싼다.
    - 통신을 시작하기 위해 클라이언트는 서버에 있는 대상 프로그램의
    이름과 위치를 결정해야한다.
    이를 위해 클라이언트는 특별한 GET 요청을 보내게된다.
        
        ![Untitled](19%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A6%E1%86%B7%20f0043131e41941a38413be094b0c924c/Untitled%201.png)
        
- FrontPage 보안 모델
    - FPSE의 보안은 웹 서버에 의존하며 FPSE의 보안 모델은 사용자를 세 가지로 정의한다.
        - 관리자 : 모든 제어 권한을 갖고 있음
        - 저작자 : 브라우징할 수 있음
        - 일반 사용자

### WebDAV와 공동 저작

- WebDAV 메서드
    - PROPFIND : 리소스의 속성을 읽는다.
    - PROPPATCH : 한 개 이상의 리소스에 대해 한 개 이상의 속성을 설정한다.
    - MKCOL : 콜렉션을 생성한다.
    - COPY : 특정 원본지에서 특정 목적지로 리소스 또는 집합을 복사한다.
    - MOVE : 특정 소스에서 특정 목적지에 리소스 또는 집합을 이동시킨다.
    - LOCK : 하나 이상의 리소스를 잠근다.
    - UNLOCK : 기존에 잠겨있는 리소스를 잠금 해제한다.
- WebDAV와 XML
    - HTTP는 보통 메시지 헤더에 요청과 응답 관련 정보를 담아 전달하는데
    헤더에만 담아 전달하는 것은 여러 개의 리소스나
    계층 관계에 있는 리소스들에 대한 정보를 선택적으로 기술하기 어려운 등의
    한계점이 존재한다.
    - WebDAV는 이를 해결하기 위해 XML을 지원한다.
    XML은 구조화된 데이터를 표현할 때 사용하는 메타 마크업 언어다.
    - WebDAV는 XML을 다음과 같은 용도로 사용한다.
        - 데이터를 어떻게 처리할 것인지 설명하는 명령 포맷
        - 서버의 복잡한 응답을 표현하는 데 사용하는 포맷
        - 콜렉션과 리소스를 처리하는 데 사용하는 커스텀 정보 포맷
        - 데이터 자체를 표현할 수 있는 유연한 포맷
        - 대부분의 국제화 관련 문제에 대한 훌륭한 해결책
- WebDAV 헤더
    - WebDAV는 새로운 메서드들의 기능을 넓혀주는 여러 HTTP 헤더를 도입했다.
        - DAV
        - Depth
        - Destination
        - Lock-Token
        - Overwrite
        - Timeout
- WebDAV 잠금과 덮어쓰기 방지
    - A와 B가 동시에 같은 문서를 작업해서 저장소에 저장할 때 서로의 버전이 통합되지 않고,
    A 또는 B의 작업물이 유실된다.
    - 이 문제를 개선하기 위해 WebDAV는 잠금 개념을 지원한다.
    물론 잠금도 문제에 대한 완벽한 해결책은 아니다.
    이런 문제를 완벽히 해결하기 위해선 버저닝과 메시징을 지원해야 한다.
    - WebDAV는 두 가지 형식의 잠금을 지원한다.
        - 베타적 쓰기 잠금
            - 잠금 소유자만 쓸 수 있게 보장하고, 잠재적인 충돌을 완벽히 제거한다.
        - 공유된 쓰기 잠금
            - 여러 사람으로 이루어져 있는 그룹이 하나의 문서에서 작업할 수 있게 한다.
            물론 이 잠금 형식은 모든 저자가 각각 서로의 활동을 인식하고 있는 상황에서 잘 동작한다.
        - WebDAV는 지원할 잠금과 형식을 결정하기 위해서 PROPFIND를 통해
        발견 메커니즘 속성을 제공한다.
        - WebDAV는 잠금과 관련한 새로운 두 개의 메서드 LOCK, UNLOCK 을 지원한다.
- LOCK 메서드
    - 여러 개의 리소스를 한 개의 LOCK 요청으로 잠글 수 있다.
    - WebDAV의 잠금은 클라이언트가 서버에 연결되어 있지 않아도 된다.
- UNLOCK 메서드
    - 대부분의 리소스 관리 요청과 WebDAV 에서
    UNLOCK이 성공하기 위한 두 가지 조건이 있다.
    
    다이제스트 인증을 완료하는 것과
    Lock-Token 헤더에 보내는 잠금 토큰이 맞는지 검사하는 것이다.
- 속성과 META 데이터
    - 속성에는 저작자의 이름, 수정날짜, 내용 등급 등과 같은 리소스의 정보를 기술한다.
    - HTML의 META 태그는 콘텐츠 일부로 그 정보들을 포함하는 메커니즘을 제공하지만,
    바이너리 데이터와 같은 리소스들은 META 데이터에 포함될 수 없다.
    - WebDAV와 같은 분산 협업 시스템은 더 복잡한 속성을 갖는데
    예를 들어 저작 속성은 문서가 편집될 때 새로운 저작자를 반영해 갱신해야 한다.
    - 속성의 발견과 수정을 지원하기 위해 WebDAV는 PROPFIND 및 PROPPATCH 메서드를
    포함해 HTTP를 확장한다.
- PROPFIND 메서드
    - PROPFIND(속성 찾기) 메서드는 주어진 파일 또는 파일 그룹(콜렉션)의
    속성을 읽는 데 사용한다.
    - PROPFIND는 다음과 같은 세 가지 형식의 동작을 지원한다.
        - 모든 속성과 그 값을 요청한다.
        - 선택된 속성과 그 값의 집합을 요청한다.
        - 모든 속성의 이름을 요청한다.
    - PROPFIND를 활용한 예는 한 번의 호출로 디렉터리의 목록을 얻는 것이다.
    호출 한 번으로 목록의 계층 관계 전체와 그 안에 존재하는 개별 엔터티의 모든 속성까지 읽을 수 있다.
- PROPPATCH 메서드
    - PROPPATCH 메서드는 특정 리소스의 여러 속성을 설정하거나 제거하는
    원자적 메커니즘을 제공한다.
    - 원자성은 모든 요청이 성공하거나 무효가 되거나 둘 중 하나만 수행하는 것을 보장한다.
- 콜렉션과 이름공간 관리
    - 콜렉션은 사전에 정의한 계층에 있는 리소스들의 논리적 혹은 물리적 그룹이다.
    - 콜렉션의 예로 디렉터리가 있다.
    이는 파일시스템의 디렉터리 같이 다른 리소스들의 컨테이너처럼 동작한다.
    - 또, 콜렉션은 다른 콜렉션을 포함한다.
    - WebDAV는 XML 이름공간 메커니즘을 사용해 XML 이름공간 파티션들은
    이름공간 충돌이 절대 생기지 않게 하고 명확한 구조적 제어 기능을 제공한다.
    - WebDAV가 이름공간을 관리하는 메서드는 다섯 개가 존재한다.
        - DELETE
        - MKCOL
        - COPY
        - MOVE
        - PROPFIND
- MKCOL 메서드
    - MKCOL 메서드는 클라이언트가 지정된 URL에 해당하는 콜렉션을 서버에 생성하게 한다.
    - 언뜻 보기엔 단순히 콜렉션을 생성하는 새로운 메서드를 정의하는 것은
    불필요해 보일 수 있지만, 다음과 같은 이유로 이러한 방식을 채택했다.
        - 콜렉션을 생성할 목적으로 PUT이나 POST를 사용하려면
        클라이언트는 추가적인 정보를 더해 보는 식으로 자체적 프로토콜을 만들어야 한다.
        이런식으로 사용하게 된다면 번거롭고 오류를 발생시키기 쉽다.
        - 대부분의 접근 제어 메커니즘은 메서드 타입에 기반해 동작한다.
        몇 가지 메서드만이 저장소에 있는 리소스를 생성하고 삭제할 수 있는데,
        만약 다른 메서드들을 본래 용도와 다르게 사용하면 이런 접근 제어 메커니즘은
        제대로 동작하지 않을 것이다.
- DELETE 메서드
    - 디렉터리를 지우려고 한다면 Depth 헤더가 필요할 것이다.
    만약 Depth 헤더가 기술되있지 않으면 DELETE 메서드는 Depth 헤더가
    무한으로 설정되어 있다고 가정하고 디렉터리와 하위 디렉터리까지
    모조리 지워버린다.
- COPY와 MOVE 메서드
    - MKCOL과 마찬가지로 COPY 및 MOVE 작업을 할 수 있는 다른 방법이 존재한다.
    - COPY 메서드의 대안은 리소스에 GET 요청을 보내고 리소스를 다운 받은 후
    PUT 요청과 함께 서버에 리소스를 다시 올리는 것이다.
    MOVE 메서드 또한 이와 유사한 방식의 대안이 존재한다.
    - 하지만 이런 방식은 다단계 콜렉션에 대한 COPY나 MOVE 작업 시 발생하는
    모든 문제를 고려했을 때 확장이 쉽지 않다는 문제가 있다.
    - COPY와 MOVE 메서드는 요청 URL을 원본의 위치 정보로 사용하고
    목적지인 Destination HTTP 헤더의 값을 목적지 정보로 사용한다.
    - MOVE 메서드는 추가로 원본지 URL을 목적지에 복사하고,
    새로 생성된 URI의 무결성을 검사하고 원본을 지운다.
- 향상된 HTTP/1.1 메서드
    - WebDAV는 HTTP 메서드인 DELETE, PUT, OPTIONS의 의미를 수정했다.
        - PUT
            - 저작자가 공용 사이트에 콘텐츠를 전송하는 유일한 방법이다.
            - WebDAV가 잠금을 제공하기 위해 If 헤더를 추가했다.
                - If헤더는 PROPPATCH, DELETE, MOVE, LOCK, UNLOCK 등과 같은
                다른 메서드들과도 함께 사용된다.
        - OPTIONS
            - 보통 WebDAV를 사용하는 클라이언트가 보내는 첫 요청에 쓰인다.
- WebDAV의 버전 관리
    - WebDAV는 신기하게 이름에 V 가 존재하지만 처음부터 버저닝이 존재한건 아니다.
    - 버저닝 자체는 RFC 3253에서 추가되었다.
- WebDAV의 미래
    - WebDAV는 현재도 잘 지원되고 있다.
    - WebDAV의 클라이언트에는
    IE 5.X 이상, 윈도우 익스플로러, 마이크로소프트 오피스 등이 존재한다.
    - WebDAV의 서버로는
    IIS 5.X 이상, mod_dav가 적용된 아파치 등이 존재한다.